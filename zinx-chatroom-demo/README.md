# Zinx 现代聊天室示例 (Zinx Chatroom Demo)

## 1. 项目简介

本项目是一个基于 [Zinx (v1.0+)](https://github.com/aceld/zinx) 框架构建的现代化、功能完善的多人在线聊天室服务器。

旨在为 Zinx 框架初学者提供一个结构清晰、代码规范、注释详尽的入门级教程，帮助开发者快速理解 Zinx 的核心设计思想和 API 用法。

### 实现功能列表

-   **连接管理**: 客户端连接成功后，服务器为其分配唯一ID，并在连接断开时自动清理资源。
-   **上线通知**: 新用户加入聊天室，所有在线用户会收到 "XXX已上线" 的广播通知。
-   **下线通知**: 用户离开聊天室，所有剩余用户会收到 "XXX已下线" 的广播通知。
-   **设置昵称**: 用户可以通过发送特定指令 `name|YourName` 来设置或更改自己的昵称。
-   **消息广播**: 用户发送的聊天消息会被服务器广播给所有其他在线用户。
-   **在线列表**: 用户可以通过发送 `who` 指令，获取当前所有在线用户的昵称列表。

## 2. 如何编译和运行

### 环境要求

-   Go 1.18+

### 步骤

1.  **下载项目**
    ```bash
    # (假定项目已存在于本地)
    cd zinx-chatroom-demo
    ```

2.  **下载依赖**
    ```bash
    go mod tidy
    ```

3.  **编译并运行服务器**
    ```bash
    go run .
    ```

    当您在终端看到 `Zinx Chatroom Server is running...` 的输出时，表示服务器已成功启动，并正在监听 `8999` 端口（Zinx默认端口）。

## 3. 客户端测试指南

您可以使用任何支持 TCP 连接的工具来测试聊天室服务器，例如 `netcat` 或 `telnet`。

以下以 `netcat` 为例进行演示。请打开 **三个** 终端窗口来模拟多用户场景。

### 终端 A: 用户 "Alice"

1.  连接服务器：
    ```bash
    nc 127.0.0.1 8999
    ```
    连接成功后，服务器不会返回任何信息，但此时终端 A 已经可以接收消息。

2.  设置昵称：
    在终端 A 中输入以下内容并回车：
    ```
    name|Alice
    ```
    *（此操作会向所有用户广播改名通知，但当前只有 Alice 在线，所以她自己看不到）*

### 终端 B: 用户 "Bob"

1.  连接服务器：
    ```bash
    nc 127.0.0.1 8999
    ```
    连接成功后，**终端 A** 会收到上线通知：
    ```
    --> User [user-2] is online.
    ```
    *（注意：因为 Bob 刚连上时是默认昵称 `user-2`，所以 Alice 看到的是默认昵称的上线通知）*

2.  设置昵称：
    在终端 B 中输入以下内容并回车：
    ```
    name|Bob
    ```
    此时，**终端 A** 会收到改名通知：
    ```
    --> User [user-2] changed name to [Bob].
    ```

### 交互演示

1.  **发送聊天消息**
    在 **终端 A** (Alice) 中输入 `Hello Bob!` 并回车。
    **终端 B** (Bob) 将会收到消息：
    ```
    [Alice]: Hello Bob!
    ```

2.  **获取在线列表**
    在 **终端 B** (Bob) 中输入 `who` 并回车。
    **终端 B** 将会收到在线列表：
    ```
    Online users: Alice, Bob
    ```

3.  **用户下线**
    在 **终端 A** (Alice) 的窗口中，按下 `Ctrl + C` 断开连接。
    **终端 B** (Bob) 将会收到下线通知：
    ```
    --> User [Alice] is offline.
    ```

通过以上步骤，您可以完整地测试本聊天室项目的所有核心功能。